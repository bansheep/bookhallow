function cov_106cw32cy4(){var path="C:\\Users\\Owner\\Desktop\\bookhallow\\bookhallow-server\\routers\\userRouter.js";var hash="7ac405a6750553529bb0be17f4598386bf924da9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Owner\\Desktop\\bookhallow\\bookhallow-server\\routers\\userRouter.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:42}},"1":{start:{line:2,column:13},end:{line:2,column:38}},"2":{start:{line:3,column:15},end:{line:3,column:34}},"3":{start:{line:4,column:12},end:{line:4,column:35}},"4":{start:{line:7,column:0},end:{line:58,column:3}},"5":{start:{line:8,column:2},end:{line:57,column:3}},"6":{start:{line:9,column:56},end:{line:9,column:64}},"7":{start:{line:12,column:4},end:{line:13,column:86}},"8":{start:{line:13,column:6},end:{line:13,column:86}},"9":{start:{line:15,column:4},end:{line:16,column:101}},"10":{start:{line:16,column:6},end:{line:16,column:101}},"11":{start:{line:18,column:4},end:{line:19,column:76}},"12":{start:{line:19,column:6},end:{line:19,column:76}},"13":{start:{line:22,column:25},end:{line:22,column:57}},"14":{start:{line:24,column:4},end:{line:25,column:78}},"15":{start:{line:25,column:6},end:{line:25,column:78}},"16":{start:{line:28,column:17},end:{line:28,column:39}},"17":{start:{line:29,column:25},end:{line:29,column:58}},"18":{start:{line:33,column:20},end:{line:33,column:85}},"19":{start:{line:34,column:22},end:{line:40,column:17}},"20":{start:{line:37,column:15},end:{line:39,column:18}},"21":{start:{line:44,column:18},end:{line:44,column:73}},"22":{start:{line:48,column:4},end:{line:50,column:14}},"23":{start:{line:55,column:4},end:{line:55,column:23}},"24":{start:{line:56,column:4},end:{line:56,column:27}},"25":{start:{line:62,column:0},end:{line:93,column:3}},"26":{start:{line:63,column:2},end:{line:91,column:3}},"27":{start:{line:64,column:33},end:{line:64,column:41}},"28":{start:{line:66,column:4},end:{line:67,column:86}},"29":{start:{line:67,column:6},end:{line:67,column:86}},"30":{start:{line:69,column:25},end:{line:69,column:55}},"31":{start:{line:70,column:4},end:{line:71,column:88}},"32":{start:{line:71,column:6},end:{line:71,column:88}},"33":{start:{line:73,column:28},end:{line:73,column:81}},"34":{start:{line:74,column:4},end:{line:75,column:88}},"35":{start:{line:75,column:6},end:{line:75,column:88}},"36":{start:{line:79,column:18},end:{line:79,column:76}},"37":{start:{line:83,column:4},end:{line:85,column:14}},"38":{start:{line:89,column:4},end:{line:89,column:23}},"39":{start:{line:90,column:4},end:{line:90,column:27}},"40":{start:{line:97,column:0},end:{line:103,column:3}},"41":{start:{line:98,column:2},end:{line:102,column:10}},"42":{start:{line:105,column:0},end:{line:119,column:2}},"43":{start:{line:106,column:4},end:{line:117,column:5}},"44":{start:{line:107,column:20},end:{line:107,column:37}},"45":{start:{line:108,column:6},end:{line:109,column:31}},"46":{start:{line:109,column:8},end:{line:109,column:31}},"47":{start:{line:111,column:6},end:{line:111,column:48}},"48":{start:{line:113,column:6},end:{line:113,column:21}},"49":{start:{line:115,column:6},end:{line:115,column:25}},"50":{start:{line:116,column:6},end:{line:116,column:22}},"51":{start:{line:122,column:0},end:{line:122,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:36},end:{line:58,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:36,column:21},end:{line:36,column:22}},loc:{start:{line:36,column:28},end:{line:40,column:16}},line:36},"2":{name:"(anonymous_2)",decl:{start:{line:62,column:22},end:{line:62,column:23}},loc:{start:{line:62,column:42},end:{line:93,column:1}},line:62},"3":{name:"(anonymous_3)",decl:{start:{line:97,column:22},end:{line:97,column:23}},loc:{start:{line:97,column:35},end:{line:103,column:1}},line:97},"4":{name:"(anonymous_4)",decl:{start:{line:105,column:24},end:{line:105,column:25}},loc:{start:{line:105,column:38},end:{line:118,column:3}},line:105}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:13,column:86}},type:"if",locations:[{start:{line:12,column:4},end:{line:13,column:86}},{start:{line:12,column:4},end:{line:13,column:86}}],line:12},"1":{loc:{start:{line:12,column:7},end:{line:12,column:58}},type:"binary-expr",locations:[{start:{line:12,column:7},end:{line:12,column:16}},{start:{line:12,column:20},end:{line:12,column:26}},{start:{line:12,column:30},end:{line:12,column:39}},{start:{line:12,column:43},end:{line:12,column:58}}],line:12},"2":{loc:{start:{line:15,column:4},end:{line:16,column:101}},type:"if",locations:[{start:{line:15,column:4},end:{line:16,column:101}},{start:{line:15,column:4},end:{line:16,column:101}}],line:15},"3":{loc:{start:{line:18,column:4},end:{line:19,column:76}},type:"if",locations:[{start:{line:18,column:4},end:{line:19,column:76}},{start:{line:18,column:4},end:{line:19,column:76}}],line:18},"4":{loc:{start:{line:24,column:4},end:{line:25,column:78}},type:"if",locations:[{start:{line:24,column:4},end:{line:25,column:78}},{start:{line:24,column:4},end:{line:25,column:78}}],line:24},"5":{loc:{start:{line:66,column:4},end:{line:67,column:86}},type:"if",locations:[{start:{line:66,column:4},end:{line:67,column:86}},{start:{line:66,column:4},end:{line:67,column:86}}],line:66},"6":{loc:{start:{line:66,column:7},end:{line:66,column:29}},type:"binary-expr",locations:[{start:{line:66,column:7},end:{line:66,column:16}},{start:{line:66,column:20},end:{line:66,column:29}}],line:66},"7":{loc:{start:{line:70,column:4},end:{line:71,column:88}},type:"if",locations:[{start:{line:70,column:4},end:{line:71,column:88}},{start:{line:70,column:4},end:{line:71,column:88}}],line:70},"8":{loc:{start:{line:74,column:4},end:{line:75,column:88}},type:"if",locations:[{start:{line:74,column:4},end:{line:75,column:88}},{start:{line:74,column:4},end:{line:75,column:88}}],line:74},"9":{loc:{start:{line:108,column:6},end:{line:109,column:31}},type:"if",locations:[{start:{line:108,column:6},end:{line:109,column:31}},{start:{line:108,column:6},end:{line:109,column:31}}],line:108}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7ac405a6750553529bb0be17f4598386bf924da9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_106cw32cy4=function(){return actualCoverage;};}return actualCoverage;}cov_106cw32cy4();const router=(cov_106cw32cy4().s[0]++,require("express").Router());const User=(cov_106cw32cy4().s[1]++,require("../models/User"));const bcrypt=(cov_106cw32cy4().s[2]++,require("bcryptjs"));const jwt=(cov_106cw32cy4().s[3]++,require("jsonwebtoken"));// Register!
cov_106cw32cy4().s[4]++;router.post("/",async(req,res)=>{cov_106cw32cy4().f[0]++;cov_106cw32cy4().s[5]++;try{const{username,email,password,passwordVerify}=(cov_106cw32cy4().s[6]++,req.body);//validation
cov_106cw32cy4().s[7]++;if((cov_106cw32cy4().b[1][0]++,!username)||(cov_106cw32cy4().b[1][1]++,!email)||(cov_106cw32cy4().b[1][2]++,!password)||(cov_106cw32cy4().b[1][3]++,!passwordVerify)){cov_106cw32cy4().b[0][0]++;cov_106cw32cy4().s[8]++;return res.status(400).json({errorMessage:"Please enter all required fields"});}else{cov_106cw32cy4().b[0][1]++;}cov_106cw32cy4().s[9]++;if(password.length<8){cov_106cw32cy4().b[2][0]++;cov_106cw32cy4().s[10]++;return res.status(400).json({errorMessage:"Please enter a password of 8 or more characters"});}else{cov_106cw32cy4().b[2][1]++;}cov_106cw32cy4().s[11]++;if(password!==passwordVerify){cov_106cw32cy4().b[3][0]++;cov_106cw32cy4().s[12]++;return res.status(400).json({errorMessage:"Passwords do not match"});}else{cov_106cw32cy4().b[3][1]++;}const existingUser=(cov_106cw32cy4().s[13]++,await User.findOne({username}));cov_106cw32cy4().s[14]++;if(existingUser){cov_106cw32cy4().b[4][0]++;cov_106cw32cy4().s[15]++;return res.status(400).json({errorMessage:"Username already exists."});}else{cov_106cw32cy4().b[4][1]++;}// hash the password
const salt=(cov_106cw32cy4().s[16]++,await bcrypt.genSalt());const passwordHash=(cov_106cw32cy4().s[17]++,await bcrypt.hash(password,salt));// save new user account
const newUser=(cov_106cw32cy4().s[18]++,new User({username:username,email:email,password:passwordHash}));const savedUser=(cov_106cw32cy4().s[19]++,newUser.save().then().catch(err=>{cov_106cw32cy4().f[1]++;cov_106cw32cy4().s[20]++;res.status(500).json({errors:[{error:err}]});}));// log user in
// sign the token
const token=(cov_106cw32cy4().s[21]++,jwt.sign({user:savedUser._id},process.env.JWT_SECRET));// send the token in a HTTP-only cookie
cov_106cw32cy4().s[22]++;res.cookie("token",token,{httpOnly:true}).send();}catch(err){cov_106cw32cy4().s[23]++;console.error(err);cov_106cw32cy4().s[24]++;res.status(500).send();}});// Login
cov_106cw32cy4().s[25]++;router.post("/login",async(req,res)=>{cov_106cw32cy4().f[2]++;cov_106cw32cy4().s[26]++;try{const{username,password}=(cov_106cw32cy4().s[27]++,req.body);cov_106cw32cy4().s[28]++;if((cov_106cw32cy4().b[6][0]++,!username)||(cov_106cw32cy4().b[6][1]++,!password)){cov_106cw32cy4().b[5][0]++;cov_106cw32cy4().s[29]++;return res.status(400).json({errorMessage:"Please enter all required fields"});}else{cov_106cw32cy4().b[5][1]++;}const existingUser=(cov_106cw32cy4().s[30]++,await User.findOne({username}));cov_106cw32cy4().s[31]++;if(!existingUser){cov_106cw32cy4().b[7][0]++;cov_106cw32cy4().s[32]++;return res.status(401).json({errorMessage:"Incorrect username and/or password "});}else{cov_106cw32cy4().b[7][1]++;}const passwordCorrect=(cov_106cw32cy4().s[33]++,await bcrypt.compare(password,existingUser.password));cov_106cw32cy4().s[34]++;if(!passwordCorrect){cov_106cw32cy4().b[8][0]++;cov_106cw32cy4().s[35]++;return res.status(401).json({errorMessage:"Incorrect username and/or password "});}else{cov_106cw32cy4().b[8][1]++;}// sign the token
const token=(cov_106cw32cy4().s[36]++,jwt.sign({user:existingUser._id},process.env.JWT_SECRET));// send the token in a HTTP-only cookie
cov_106cw32cy4().s[37]++;res.cookie("token",token,{httpOnly:true}).send();}catch(err){cov_106cw32cy4().s[38]++;console.error(err);cov_106cw32cy4().s[39]++;res.status(500).send();}});// Log out
cov_106cw32cy4().s[40]++;router.get("/logout",(req,res)=>{cov_106cw32cy4().f[3]++;cov_106cw32cy4().s[41]++;res.cookie("token","",{httpOnly:true,expires:new Date(0)}).send();});cov_106cw32cy4().s[42]++;router.get("/loggedIn",(req,res)=>{cov_106cw32cy4().f[4]++;cov_106cw32cy4().s[43]++;try{const token=(cov_106cw32cy4().s[44]++,req.cookies.token);cov_106cw32cy4().s[45]++;if(!token){cov_106cw32cy4().b[9][0]++;cov_106cw32cy4().s[46]++;return res.json(false);}else{cov_106cw32cy4().b[9][1]++;}cov_106cw32cy4().s[47]++;jwt.verify(token,process.env.JWT_SECRET);cov_106cw32cy4().s[48]++;res.send(true);}catch(err){cov_106cw32cy4().s[49]++;console.error(err);cov_106cw32cy4().s[50]++;res.json(false);}});cov_106cw32cy4().s[51]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJSb3V0ZXIuanMiXSwibmFtZXMiOlsicm91dGVyIiwicmVxdWlyZSIsIlJvdXRlciIsIlVzZXIiLCJiY3J5cHQiLCJqd3QiLCJwb3N0IiwicmVxIiwicmVzIiwidXNlcm5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicGFzc3dvcmRWZXJpZnkiLCJib2R5Iiwic3RhdHVzIiwianNvbiIsImVycm9yTWVzc2FnZSIsImxlbmd0aCIsImV4aXN0aW5nVXNlciIsImZpbmRPbmUiLCJzYWx0IiwiZ2VuU2FsdCIsInBhc3N3b3JkSGFzaCIsImhhc2giLCJuZXdVc2VyIiwic2F2ZWRVc2VyIiwic2F2ZSIsInRoZW4iLCJjYXRjaCIsImVyciIsImVycm9ycyIsImVycm9yIiwidG9rZW4iLCJzaWduIiwidXNlciIsIl9pZCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiY29va2llIiwiaHR0cE9ubHkiLCJzZW5kIiwiY29uc29sZSIsInBhc3N3b3JkQ29ycmVjdCIsImNvbXBhcmUiLCJnZXQiLCJleHBpcmVzIiwiRGF0ZSIsImNvb2tpZXMiLCJ2ZXJpZnkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiZ3ROQWVZOzJGQWZaLEtBQU1BLENBQUFBLE1BQU0sMEJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVAsQ0FBbUJDLE1BQW5CLEVBQUgsQ0FBWixDQUNBLEtBQU1DLENBQUFBLElBQUksMEJBQUdGLE9BQU8sQ0FBQyxnQkFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNRyxDQUFBQSxNQUFNLDBCQUFHSCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNSSxDQUFBQSxHQUFHLDBCQUFHSixPQUFPLENBQUMsY0FBRCxDQUFWLENBQVQsQ0FFQTt3QkFDQUQsTUFBTSxDQUFDTSxJQUFQLENBQVksR0FBWixDQUFpQixNQUFPQyxHQUFQLENBQVdDLEdBQVgsR0FBbUIsaURBQ2xDLEdBQUcsQ0FDRCxLQUFNLENBQUNDLFFBQUQsQ0FBV0MsS0FBWCxD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PSByZXF1aXJlKFwiZXhwcmVzc1wiKS5Sb3V0ZXIoKTtcclxuY29uc3QgVXNlciA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvVXNlclwiKTtcclxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZShcImJjcnlwdGpzXCIpO1xyXG5jb25zdCBqd3QgPSByZXF1aXJlKFwianNvbndlYnRva2VuXCIpO1xyXG5cclxuLy8gUmVnaXN0ZXIhXHJcbnJvdXRlci5wb3N0KFwiL1wiLCBhc3luYyAocmVxLHJlcykgPT4ge1xyXG4gIHRyeXtcclxuICAgIGNvbnN0IHt1c2VybmFtZSwgZW1haWwsIHBhc3N3b3JkLCBwYXNzd29yZFZlcmlmeX0gPSByZXEuYm9keTtcclxuXHJcbi8vdmFsaWRhdGlvblxyXG4gICAgaWYoIXVzZXJuYW1lIHx8ICFlbWFpbCB8fCAhcGFzc3dvcmQgfHwgIXBhc3N3b3JkVmVyaWZ5KVxyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe2Vycm9yTWVzc2FnZTogXCJQbGVhc2UgZW50ZXIgYWxsIHJlcXVpcmVkIGZpZWxkc1wifSk7XHJcblxyXG4gICAgaWYocGFzc3dvcmQubGVuZ3RoIDwgOClcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtlcnJvck1lc3NhZ2U6IFwiUGxlYXNlIGVudGVyIGEgcGFzc3dvcmQgb2YgOCBvciBtb3JlIGNoYXJhY3RlcnNcIn0pO1xyXG5cclxuICAgIGlmKHBhc3N3b3JkICE9PSBwYXNzd29yZFZlcmlmeSlcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtlcnJvck1lc3NhZ2U6IFwiUGFzc3dvcmRzIGRvIG5vdCBtYXRjaFwifSk7XHJcblxyXG5cclxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHVzZXJuYW1lIH0pO1xyXG5cclxuICAgIGlmKGV4aXN0aW5nVXNlcilcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtlcnJvck1lc3NhZ2U6IFwiVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMuXCJ9KTtcclxuXHJcbiAgICAvLyBoYXNoIHRoZSBwYXNzd29yZFxyXG4gICAgY29uc3Qgc2FsdCA9IGF3YWl0IGJjcnlwdC5nZW5TYWx0KCk7XHJcbiAgICBjb25zdCBwYXNzd29yZEhhc2ggPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdCk7XHJcblxyXG4gICAgLy8gc2F2ZSBuZXcgdXNlciBhY2NvdW50XHJcblxyXG4gICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VyKHt1c2VybmFtZTp1c2VybmFtZSwgZW1haWw6ZW1haWwsIHBhc3N3b3JkOnBhc3N3b3JkSGFzaH0pO1xyXG4gICAgY29uc3Qgc2F2ZWRVc2VyID0gbmV3VXNlci5zYXZlKClcclxuICAgICAgICAgICAgICAudGhlbigpXHJcbiAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgZXJyb3JzOiBbeyBlcnJvcjogZXJyIH1dXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAvLyBsb2cgdXNlciBpblxyXG4gICAgLy8gc2lnbiB0aGUgdG9rZW5cclxuICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oe3VzZXI6IHNhdmVkVXNlci5faWR9LCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcclxuXHJcbiAgICAvLyBzZW5kIHRoZSB0b2tlbiBpbiBhIEhUVFAtb25seSBjb29raWVcclxuXHJcbiAgICByZXMuY29va2llKFwidG9rZW5cIiwgdG9rZW4sIHtcclxuICAgICAgaHR0cE9ubHk6IHRydWVcclxuICAgIH0pLnNlbmQoKTtcclxuXHJcblxyXG4gIH1cclxuICBjYXRjaChlcnIpe1xyXG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIExvZ2luXHJcbnJvdXRlci5wb3N0KFwiL2xvZ2luXCIsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeXtcclxuICAgIGNvbnN0IHt1c2VybmFtZSwgcGFzc3dvcmR9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYoIXVzZXJuYW1lIHx8ICFwYXNzd29yZClcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtlcnJvck1lc3NhZ2U6IFwiUGxlYXNlIGVudGVyIGFsbCByZXF1aXJlZCBmaWVsZHNcIn0pO1xyXG5cclxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7dXNlcm5hbWV9KTtcclxuICAgIGlmKCFleGlzdGluZ1VzZXIpXHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7ZXJyb3JNZXNzYWdlOiBcIkluY29ycmVjdCB1c2VybmFtZSBhbmQvb3IgcGFzc3dvcmQgXCJ9KVxyXG5cclxuICAgIGNvbnN0IHBhc3N3b3JkQ29ycmVjdCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBleGlzdGluZ1VzZXIucGFzc3dvcmQpO1xyXG4gICAgaWYoIXBhc3N3b3JkQ29ycmVjdClcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtlcnJvck1lc3NhZ2U6IFwiSW5jb3JyZWN0IHVzZXJuYW1lIGFuZC9vciBwYXNzd29yZCBcIn0pXHJcblxyXG5cclxuICAgIC8vIHNpZ24gdGhlIHRva2VuXHJcbiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHt1c2VyOiBleGlzdGluZ1VzZXIuX2lkfSwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcblxyXG4gICAgLy8gc2VuZCB0aGUgdG9rZW4gaW4gYSBIVFRQLW9ubHkgY29va2llXHJcblxyXG4gICAgcmVzLmNvb2tpZShcInRva2VuXCIsIHRva2VuLCB7XHJcbiAgICAgIGh0dHBPbmx5OiB0cnVlXHJcbiAgICB9KS5zZW5kKCk7XHJcblxyXG4gIH1cclxuICBjYXRjaChlcnIpe1xyXG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoKTtcclxuICB9XHJcblxyXG59KTtcclxuXHJcblxyXG4vLyBMb2cgb3V0XHJcbnJvdXRlci5nZXQoXCIvbG9nb3V0XCIsIChyZXEscmVzKSA9PiB7XHJcbiAgcmVzLmNvb2tpZShcInRva2VuXCIsIFwiXCIsIHtcclxuICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgZXhwaXJlczogbmV3IERhdGUoMClcclxuICB9KVxyXG4gIC5zZW5kKCk7XHJcbn0pO1xyXG5cclxucm91dGVyLmdldChcIi9sb2dnZWRJblwiLCAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XHJcbiAgICAgIGlmICghdG9rZW4pXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKGZhbHNlKTtcclxuXHJcbiAgICAgIGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG5cclxuICAgICAgcmVzLnNlbmQodHJ1ZSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICByZXMuanNvbihmYWxzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4pO1xyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xyXG4iXX0=